{"version":3,"sources":["webpack:///./src/prefabs/MapElement.ts","webpack:///./src/utils/mathUtils.ts","webpack:///./src/index.ts","webpack:///./src/states/BootState.ts","webpack:///./src/states/PreloadState.ts","webpack:///./src/states/GameState.ts","webpack:///./src/prefabs/Terrain.ts","webpack:///./src/utils/boardUtils.ts","webpack:///./src/prefabs/Item.ts","webpack:///./src/prefabs/Enemy.ts","webpack:///./src/states/GameOverState.ts"],"names":["exports","default","Phaser","TileSprite","[object Object]","game","x","y","size","texture","frames","super","this","anchor","set","length","animations","add","play","alive","exists","visible","randomBetween","a","b","isInteger","numBetween","Math","random","floor","__webpack_require__","BootState_1","PreloadState_1","GameState_1","GameOverState_1","Game","config","state","start","width","height","renderer","AUTO","parent","resolution","State","stage","backgroundColor","scale","scaleMode","ScaleManager","NO_SCALE","pageAlignHorizontally","pageAlignVertically","load","image","preloadBar","sprite","world","centerX","centerY","setTo","setPreloadSprite","spritesheet","undefined","json","Terrain_1","mathUtils_1","ROWS","COLS","TILE_SIZE","LABEL_STYLE","font","fill","align","defaultGameData","theme","stats","health","attack","defense","gold","hasKey","__board","rows","cols","data","__currentFloor","__playerStats","Object","assign","__currentTheme","__levelData","cache","getJSON","__backgroundTiles","group","__mapElements","createBackgroundTiles","cell","clearDarknessTile","__darkTiles","createProps","createItems","item","refreshStats","kill","createKey","levels","key","showLabel","createEnemies","enemy","enemyDamage","round","max","toString","playerDamage","camera","flash","tween","to","tint","onComplete","addOnce","tweens","removeFrom","gameOver","createExit","exit","nextLevel","entranceCell","createEntrance","createDarkTiles","__walls","createWalls","initGui","__hudMessages","__healthLabel","text","ceil","__attackLabel","__defenseLabel","__goldLabel","__keyIcon","alpha","__healthIcon","frame","fade","onFadeComplete","bitmapRect","bitmapData","ctx","fillStyle","fillRect","style","tileSprite","__attackIcon","__defenseIcon","__goldIcon","__levelLabel","name","input","enabled","mapElement","message","duration","label","Text","destroy","boardUtils","MapElement_1","Item_1","Enemy_1","getFreeCell","board","freeCell","currentCell","foundCell","currentChild","row","col","i","len","children","getCellFromXY","levelData","onInput","tile","level","j","tiles","inputEnabled","events","onInputDown","Group","levelIndex","numCells","countCells","numItems","coefs","propOccupation","propVariation","currentLevel","props","common","type","propData","prop","point","getXYFromCell","onCollect","itemOccupation","itemVariation","itemData","createListener","items","onAttack","enemyOccupation","enemyVariation","enemyData","coef","pow","levelIncrement","enemies","position","onExit","entrance","darkTiles","mapElements","considerEnemies","considerNeighbors","considerClear","surroundingCells","getSurroundingCells","currentDarkTileIndex","getIndexFromCell","currentDarkTile","currentMapElementPoint","currentMapElement","find","el","findIndex","c","index","darkTile","cells","some","forEach","walls","top","side","relativePositions","adjacentTiles","relPos","relRow","relCol","push","getCellFromIndex","compareCells","__data","keyboard","addCallbacks","startGame","mouse","onTap","shutdown","removeCallbacks"],"mappings":"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","file":"game.js","sourcesContent":["export default class MapElement extends Phaser.TileSprite {\n  constructor(game:Phaser.Game, x:number, y:number, size:number, texture:string, frames:number[]) {\n    super(game, x, y, size, size, texture, frames[0]);\n\n    this.anchor.set(.5, .5);\n\n    if (frames.length > 1) {\n      this.animations.add('idle', frames, 10, true);\n      this.play('idle');\n    }\n  }\n  kill():void {\n    this.alive = this.exists = this.visible = false;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/tslint-loader!./src/prefabs/MapElement.ts","export const randomBetween = (a:number, b:number, isInteger:boolean=false):number => {\n  let numBetween:number = a + Math.random() * (b - a);\n\n  if (isInteger) {\n    numBetween = Math.floor(numBetween);\n  }\n\n  return numBetween;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/tslint-loader!./src/utils/mathUtils.ts","import 'pixi';\nimport 'p2';\nimport 'phaser';\n\nimport BootState from './states/BootState';\nimport PreloadState from './states/PreloadState';\nimport GameState from './states/GameState';\nimport GameOverState from './states/GameOverState';\n\nclass RPG extends Phaser.Game {\n  constructor(config:Phaser.IGameConfig) {\n    super(config);\n\n    this.state.add('Boot', BootState);\n    this.state.add('Preload', PreloadState);\n    this.state.add('Game', GameState);\n    this.state.add('GameOver', GameOverState);\n\n    this.state.start('Boot');\n  }\n}\n\nconst config:Phaser.IGameConfig = {\n  width: 576,\n  height: 576,\n  renderer: Phaser.AUTO,\n  parent: 'game',\n  resolution: 1\n};\n\nnew RPG(config);\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/tslint-loader!./src/index.ts","export default class BootState extends Phaser.State {\n  init() {\n    this.game.stage.backgroundColor = '#000';\n    this.scale.scaleMode = Phaser.ScaleManager.NO_SCALE;\n    this.scale.pageAlignHorizontally = true;\n    this.scale.pageAlignVertically = true;\n  }\n  preload() {\n    this.load.image('bar', 'assets/images/preloader-bar.png');\n  }\n  create() {\n    this.state.start('Preload');\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/tslint-loader!./src/states/BootState.ts","export default class PreloadState extends Phaser.State {\n  preload() {\n    const preloadBar = this.add.sprite(this.game.world.centerX, this.game.world.centerY, 'bar');\n    preloadBar.anchor.setTo(0.5);\n    preloadBar.scale.setTo(100, 1);\n\n    this.load.setPreloadSprite(preloadBar);\n\n    this.load.spritesheet('heroes', 'assets/images/uf_heroes.png', 48, 48, undefined, 0, 0);\n    this.load.spritesheet('items', 'assets/images/uf_items.png', 48, 48, undefined, 0, 0);\n    this.load.spritesheet('terrain', 'assets/images/uf_terrain.png', 48, 48, undefined, 0, 0);\n\n    this.load.json('gameBaseData', 'assets/data/gameBaseData.json');\n  }\n  create() {\n    this.state.start('Game');\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/tslint-loader!./src/states/PreloadState.ts","import {\n  clearDarknessTile,\n  createBackgroundTiles,\n  createDarkTiles, createEnemies, createEntrance, createExit, createItems, createKey, createProps, createWalls,\n  getFreeCell,\n} from '../prefabs/Terrain';\n\nimport {\n  IBoardData, ICell,\n  IGameData, ILevelData,\n  IPlayerStats\n} from '../interfaces';\n\nimport MapElement from '../prefabs/MapElement';\nimport Item from '../prefabs/Item';\nimport Enemy from '../prefabs/Enemy';\nimport {randomBetween} from '../utils/mathUtils';\n\nconst ROWS = 10;\nconst COLS = 10;\n\nconst TILE_SIZE = 48;\n\nconst LABEL_STYLE = {\n  font: '8px Pixel',\n  fill: '#ffffff',\n  align: 'center'\n};\n\nconst defaultGameData:IGameData = {\n  floor: 1,\n  theme: 0,\n  stats: {\n    health: 25,\n    attack: 2,\n    defense: 1,\n    gold: 0,\n    hasKey: false\n  }\n};\n\nexport default class GameState extends Phaser.State {\n\n  protected __playerStats:IPlayerStats;\n\n  protected __currentFloor:number;\n\n  protected __currentTheme:number;\n\n  protected __backgroundTiles:Phaser.Group;\n\n  protected __mapElements:Phaser.Group;\n\n  protected __darkTiles:Phaser.Group;\n\n  protected __walls:Phaser.Group;\n\n  protected __hudMessages:Phaser.Group;\n\n  protected __levelData:ILevelData;\n\n  protected __board:IBoardData = {\n    rows: ROWS,\n    cols: COLS,\n    size: TILE_SIZE\n  };\n\n  private __healthIcon:Phaser.TileSprite;\n  private __healthLabel:Phaser.Text;\n\n  private __attackIcon:Phaser.TileSprite;\n  private __attackLabel:Phaser.Text;\n\n  private __defenseIcon:Phaser.TileSprite;\n  private __defenseLabel:Phaser.Text;\n\n  private __goldIcon:Phaser.TileSprite;\n  private __goldLabel:Phaser.Text;\n\n  private __levelLabel:Phaser.Text;\n\n  private __keyIcon:Phaser.TileSprite;\n\n  init(data:IGameData=defaultGameData) {\n    this.__currentFloor = data.floor;\n    this.__playerStats = { ...data.stats };\n    this.__currentTheme = data.theme;\n  }\n\n  create() {\n    this.__levelData = this.game.cache.getJSON('gameBaseData') as ILevelData;\n\n    this.__backgroundTiles = this.game.add.group();\n    this.__backgroundTiles.x = this.__board.size;\n    this.__backgroundTiles.y = this.__board.size;\n\n    this.__mapElements = this.game.add.group();\n    this.__mapElements.x = this.__board.size;\n    this.__mapElements.y = this.__board.size;\n\n    createBackgroundTiles(this.__backgroundTiles, this.__levelData, this.__currentTheme, this.__board, (cell:ICell):void => {\n      clearDarknessTile(this.__darkTiles, this.__mapElements, cell, this.__board, true);\n    });\n\n    createProps(this.__mapElements, this.__board, this.__levelData, this.__currentTheme);\n\n    createItems(this.__mapElements, this.__board, this.__levelData, (cell:ICell, item:Item) => {\n      clearDarknessTile(this.__darkTiles, this.__mapElements, cell, this.__board, true, false, false);\n\n      this.__playerStats.gold += item.data.gold || 0;\n      this.__playerStats.health += item.data.health || 0;\n      this.__playerStats.attack += item.data.attack || 0;\n      this.__playerStats.defense += item.data.defense || 0;\n\n      this.refreshStats();\n\n      item.kill();\n    });\n\n    createKey(this.__mapElements, this.__levelData.levels[this.__currentTheme].key, this.__board, (cell:ICell, key:MapElement):void => {\n      clearDarknessTile(this.__darkTiles, this.__mapElements, cell, this.__board, true, false);\n\n      this.__playerStats.hasKey = true;\n\n      this.refreshStats();\n\n      key.kill();\n\n      this.showLabel(key, 'You found the key. Find the exit', 1000);\n    });\n\n    createEnemies(this.__mapElements, this.__board, this.__levelData, this.__currentTheme, this.__currentFloor, (cell:ICell, enemy:Enemy):void => {\n      const enemyDamage = Math.round(\n        Math.max(0.5, this.__playerStats.attack * Math.random() - enemy.data.defense * Math.random()) * 100\n      ) / 100;\n\n      enemy.data.health -= enemyDamage;\n\n      this.showLabel(enemy, enemyDamage.toString());\n\n      const playerDamage = Math.round(\n        Math.max(0.5, enemy.data.attack * Math.random() - this.__playerStats.defense * Math.random()) * 100\n      ) / 100;\n\n      this.__playerStats.health -= playerDamage;\n\n      this.refreshStats();\n\n      this.camera.flash(0xcc0000, 300, false, 0.25);\n\n      this.game.add.tween(enemy)\n        .to({ tint: 0xff0000 }, 300, null, true)\n        .onComplete.addOnce(() => {\n          this.game.tweens.removeFrom(enemy);\n\n          enemy.tint = 0xffffff;\n\n          if (enemy.data.health <= 0) {\n            this.__playerStats.gold += enemy.data.gold;\n\n            enemy.kill();\n\n            clearDarknessTile(this.__darkTiles, this.__mapElements, cell, this.__board, true, false, false);\n          }\n\n          if (this.__playerStats.health <= 0) {\n            this.gameOver();\n          }\n        });\n    });\n\n    createExit(this.__mapElements, this.__levelData.levels[this.__currentTheme].exit, this.__board, (cell:ICell, exit:MapElement) => {\n      if (this.__playerStats.hasKey) {\n        this.nextLevel();\n      } else {\n        this.showLabel(exit, 'You need a key', 1000);\n      }\n    });\n\n    const entranceCell = createEntrance(this.__mapElements, this.__board);\n\n    this.__darkTiles = createDarkTiles(this.game, this.__board);\n    this.__darkTiles.x = this.__board.size;\n    this.__darkTiles.y = this.__board.size;\n\n    clearDarknessTile(this.__darkTiles, this.__mapElements, entranceCell, this.__board, true, false, false);\n\n    this.__walls = this.game.add.group();\n\n    createWalls(this.__walls, this.__levelData, this.__currentTheme, this.__board);\n\n    this.initGui();\n\n    this.refreshStats();\n\n    this.__hudMessages = this.game.add.group();\n    this.__hudMessages.x = this.__board.size;\n    this.__hudMessages.y = this.__board.size;\n  }\n\n  refreshStats():void {\n    this.__healthLabel.text = Math.ceil(this.__playerStats.health).toString();\n    this.__attackLabel.text = Math.ceil(this.__playerStats.attack).toString();\n    this.__defenseLabel.text = Math.ceil(this.__playerStats.defense).toString();\n    this.__goldLabel.text = Math.ceil(this.__playerStats.gold).toString();\n\n    this.__keyIcon.alpha = this.__playerStats.hasKey ? 1.0 : 0.25;\n\n    if (this.__playerStats.health < 5) {\n      this.__healthIcon.frame = 16;\n    } else if (this.__playerStats.health < 15) {\n      this.__healthIcon.frame = 17;\n    } else {\n      this.__healthIcon.frame = 18;\n    }\n  }\n\n  nextLevel():void {\n    this.camera.fade(0x000000);\n    this.camera.onFadeComplete.addOnce(() => {\n      this.game.state.start('Game', true, false, {\n        floor: this.__currentFloor + 1,\n        theme: randomBetween(1, this.__levelData.levels.length, true),\n        stats: { ...this.__playerStats, hasKey: false }\n      });\n    });\n  }\n\n  protected initGui():void {\n    const x = 0;\n    const y = TILE_SIZE * ROWS + TILE_SIZE;\n\n    const bitmapRect = this.add.bitmapData(this.game.width, this.game.height - TILE_SIZE);\n\n    bitmapRect.ctx.fillStyle = '#111111';\n    bitmapRect.ctx.fillRect(0, 0, this.game.width, TILE_SIZE);\n\n    this.add.sprite(0, y, bitmapRect);\n\n    const style = {\n      font: '12px Pixel',\n      fill: '#fff',\n      align: 'left'\n    };\n\n    this.__healthIcon = this.add.tileSprite(x, y, TILE_SIZE, TILE_SIZE, 'items', 18);\n    this.__healthLabel = this.add.text(x + TILE_SIZE, y + 20, '99+', style);\n\n    this.__attackIcon = this.add.tileSprite(x + TILE_SIZE * 2, y, TILE_SIZE, TILE_SIZE, 'items', 44);\n    this.__attackLabel = this.add.text(x + TILE_SIZE * 3, y + 20, '99+', style);\n\n    this.__defenseIcon = this.add.tileSprite(x + TILE_SIZE * 4, y, TILE_SIZE, TILE_SIZE, 'items', 115);\n    this.__defenseLabel = this.add.text(x + TILE_SIZE * 5, y + 20, '99+', style);\n\n    this.__goldIcon = this.add.tileSprite(x + TILE_SIZE * 6, y, TILE_SIZE, TILE_SIZE, 'items', 15);\n    this.__goldLabel = this.add.text(x + TILE_SIZE * 7, y + 20, '999+', style);\n\n    this.__keyIcon = this.add.tileSprite(x + TILE_SIZE * COLS + TILE_SIZE, y, TILE_SIZE, TILE_SIZE, 'items', this.__levelData.levels[this.__currentTheme].key[0]);\n\n    this.__levelLabel = this.add.text(10, 10, `${this.__levelData.levels[this.__currentTheme].name}: floor ${this.__currentFloor}`, {\n      ...style,\n      font: '9px Pixel'\n    });\n  }\n\n  protected gameOver():void {\n    this.game.input.enabled = false;\n    this.camera.fade(0x330000, 300, true, 1);\n    this.camera.onFadeComplete.addOnce(() => {\n      this.game.input.enabled = true;\n      this.game.state.start('GameOver');\n    });\n  }\n\n  protected showLabel(mapElement:MapElement, message:string, duration:number=500):void {\n    const label = new Phaser.Text(this.game, mapElement.x, mapElement.y, message, LABEL_STYLE);\n\n    label.anchor.setTo(.5, .5);\n\n    this.game.add.tween(label)\n      .to({ y: label.y - mapElement.height * .5, alpha: 0.25 }, duration, null, true)\n      .onComplete.addOnce(() => {\n        label.destroy(true);\n      });\n\n    this.__hudMessages.add(label);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/tslint-loader!./src/states/GameState.ts","import {IBoardData, ICell, IEnemy, IItem, ILevelData, IPoint, IProp} from '../interfaces';\nimport * as boardUtils from '../utils/boardUtils';\nimport {randomBetween} from '../utils/mathUtils';\nimport MapElement from './MapElement';\nimport Item from './Item';\nimport Enemy from './Enemy';\n\nexport const getFreeCell = (group:Phaser.Group, board:IBoardData):ICell => {\n  let freeCell:ICell, currentCell:ICell, foundCell:boolean;\n  let currentChild:Phaser.TileSprite, row:number, col:number, i:number;\n\n  const len = group.length;\n\n  while (!freeCell) {\n    foundCell = false;\n\n    row = randomBetween(0, board.rows, true);\n    col = randomBetween(0, board.cols, true);\n\n    for (i = 0; i < len; i++) {\n      currentChild = group.children[i] as Phaser.TileSprite;\n      currentCell = boardUtils.getCellFromXY(currentChild, board);\n      if (currentChild && currentChild.alive && currentCell.row === row && currentCell.col === col) {\n        foundCell = true;\n        break;\n      }\n    }\n\n    if (!foundCell) {\n      freeCell = { row, col };\n    }\n  }\n\n  return freeCell;\n};\n\nexport const createBackgroundTiles = (group:Phaser.Group, levelData:ILevelData, theme:number, board:IBoardData, onInput:Function):void => {\n  let frame:number, tile:Phaser.TileSprite;\n\n  const level = levelData.levels[theme];\n\n  for (let i:number = 0; i < board.rows; i++) {\n    for (let j:number = 0; j < board.cols; j++) {\n      frame = randomBetween(0, level.tiles.length, true);\n      tile = new Phaser.TileSprite(group.game, j * board.size, i * board.size, board.size, board.size, 'terrain', level.tiles[frame]);\n      tile.inputEnabled = true;\n      tile.events.onInputDown.add(() => {\n        onInput({ row: i, col: j }, tile);\n      });\n\n      group.add(tile);\n    }\n  }\n};\n\nexport const createDarkTiles = (game:Phaser.Game, board:IBoardData):Phaser.Group => {\n  const group = new Phaser.Group(game);\n\n  let tile:Phaser.TileSprite;\n\n  for (let i:number = 0; i < board.rows; i++) {\n    for (let j:number = 0; j < board.cols; j++) {\n      tile = new Phaser.TileSprite(game, j * board.size, i * board.size, board.size, board.size, 'terrain', 153);\n      tile.alpha = 0.7;\n\n      group.add(tile);\n    }\n  }\n\n  return group;\n};\n\nexport const createProps = (group:Phaser.Group, board:IBoardData, levelData:ILevelData, levelIndex:number):void => {\n  const numCells = boardUtils.countCells(board);\n  const numItems = Math.round(numCells * levelData.coefs.propOccupation * randomBetween(1 - levelData.coefs.propVariation, 1 + levelData.coefs.propVariation));\n\n  const currentLevel = levelData.levels[levelIndex];\n  const props = [ ...levelData.common.props, ...currentLevel.props ];\n\n  let type:number, propData:IProp, prop:MapElement, cell:ICell, point:IPoint;\n\n  for (let i = 0; i < numItems; i++) {\n    type = randomBetween(0, props.length, true);\n\n    propData = props[type];\n\n    cell = getFreeCell(group, board);\n    point = boardUtils.getXYFromCell(cell, board);\n\n    prop = new MapElement(group.game, point.x, point.y, board.size, 'terrain', propData.frames);\n    prop.inputEnabled = false;\n    // prop.visible = false;\n    group.add(prop);\n  }\n};\n\nexport const createItems = (group:Phaser.Group, board:IBoardData, levelData:ILevelData, onCollect:Function):void => {\n  const numCells = boardUtils.countCells(board);\n  const numItems = Math.round(\n    numCells * levelData.coefs.itemOccupation * randomBetween(1 - levelData.coefs.itemVariation, 1 + levelData.coefs.itemVariation)\n  );\n\n  let type:number, itemData:IItem, item:Item, cell:ICell, point:IPoint;\n\n  const createListener = (cell, item) => () => onCollect(cell, item);\n\n  for (let i = 0; i < numItems; i++) {\n    type = randomBetween(0, levelData.items.length, true);\n\n    itemData = levelData.items[type];\n\n    cell = getFreeCell(group, board);\n    point = boardUtils.getXYFromCell(cell, board);\n\n    item = new Item(group.game, point.x, point.y, board.size, itemData);\n    item.visible = false;\n    item.inputEnabled = true;\n    item.events.onInputDown.addOnce(createListener(cell, item));\n\n    group.add(item);\n  }\n};\n\nexport const createEnemies = (group:Phaser.Group, board:IBoardData, levelData:ILevelData, levelIndex:number, floor:number, onAttack:Function):void => {\n  const numCells = boardUtils.countCells(board);\n  const numItems = Math.round(\n    numCells * levelData.coefs.enemyOccupation * randomBetween(1 - levelData.coefs.enemyVariation, 1 + levelData.coefs.enemyVariation)\n  );\n\n  const currentLevel = levelData.levels[levelIndex];\n  let type:number, enemyData:IEnemy, enemy:Enemy, cell:ICell, point:IPoint;\n\n  const createListener = (cell:ICell, enemy:Enemy) => () => onAttack(cell, enemy);\n  const coef = Math.pow(levelData.coefs.levelIncrement, floor);\n  const enemies = [ ...levelData.common.enemies, ...currentLevel.enemies ];\n\n  for (let i = 0; i < numItems; i++) {\n    type = randomBetween(0, enemies.length, true);\n\n    enemyData = enemies[type];\n\n    cell = getFreeCell(group, board);\n    point = boardUtils.getXYFromCell(cell, board);\n\n    enemy = new Enemy(group.game, point.x, point.y, board.size, {\n      ...enemyData,\n      attack: enemyData.attack * coef,\n      defense: enemyData.defense * coef,\n      health: enemyData.health * coef,\n      gold: enemyData.gold * coef\n    });\n    enemy.visible = false;\n    enemy.inputEnabled = true;\n    enemy.events.onInputDown.add(createListener(cell, enemy));\n\n    group.add(enemy);\n  }\n};\n\nexport const createKey = (group:Phaser.Group, frames:number[], board:IBoardData, onCollect:Function):ICell => {\n  const cell:ICell = getFreeCell(group, board);\n  const position:IPoint = boardUtils.getXYFromCell(cell, board);\n  const key = new MapElement(group.game, position.x, position.y, board.size, 'items', frames);\n  key.visible = false;\n  key.inputEnabled = true;\n  key.events.onInputDown.addOnce(() => {\n    onCollect(cell, key);\n  });\n  group.add(key);\n\n  return cell;\n};\n\nexport const createExit = (group:Phaser.Group, frames:number[], board:IBoardData, onExit:Function):ICell => {\n  const cell = getFreeCell(group, board);\n  const position = boardUtils.getXYFromCell(cell, board);\n  const exit = new MapElement(group.game, position.x, position.y, board.size, 'terrain', frames);\n\n  exit.anchor.set(.5, .5);\n  exit.visible = false;\n  exit.inputEnabled = true;\n  exit.events.onInputDown.add(() => {\n    onExit(cell, exit);\n  });\n  group.add(exit);\n\n  return cell;\n};\n\nexport const createEntrance = (group:Phaser.Group, board:IBoardData):ICell => {\n  const cell = getFreeCell(group, board);\n  const position = boardUtils.getXYFromCell(cell, board);\n  const entrance = new MapElement(group.game, position.x, position.y, board.size, 'terrain', [571]);\n  group.add(entrance);\n\n  return cell;\n};\n\nexport const clearDarknessTile = (darkTiles:Phaser.Group, mapElements:Phaser.Group, cell:ICell, board:IBoardData, considerEnemies:boolean=true, considerNeighbors:boolean=true, considerClear:boolean=true) => {\n  const surroundingCells:ICell[] = boardUtils.getSurroundingCells(cell, board);\n\n  if (considerClear) {\n    const currentDarkTileIndex = boardUtils.getIndexFromCell(cell, board);\n    const currentDarkTile = darkTiles.children[currentDarkTileIndex] as Phaser.TileSprite;\n\n    if (!(currentDarkTile.alive && currentDarkTile.visible && currentDarkTile.exists)) {\n      return;\n    }\n\n    const currentMapElementPoint = boardUtils.getXYFromCell(cell, board);\n    const currentMapElement = mapElements.children.find((el) => el.x === currentMapElementPoint.x && el.y === currentMapElementPoint.y);\n\n    if (currentMapElement && currentMapElement.visible) {\n      return;\n    }\n  }\n\n  if (considerNeighbors) {\n    const hasClearNeighbor = -1 !== surroundingCells.findIndex((c:ICell) => {\n      const index = boardUtils.getIndexFromCell(c, board);\n      const darkTile = darkTiles.children[index] as Phaser.TileSprite;\n\n      return !(darkTile.alive && darkTile.visible && darkTile.exists);// TODO Refactor\n    });\n\n    if (!hasClearNeighbor) {\n      return;\n    }\n  }\n\n  const cells:ICell[] = [cell, ...surroundingCells];\n\n  if (considerEnemies) {\n    const hasMonster = cells.some((c:ICell) => {\n      const point = boardUtils.getXYFromCell(c, board);\n\n      const enemy = mapElements.children.find(\n        (el:MapElement) => (el instanceof Enemy && el.x === point.x && el.y === point.y)\n      ) as Enemy;\n\n      return enemy && enemy.alive && enemy.visible;\n    });\n\n    if (hasMonster) {\n      return;\n    }\n  }\n\n  cells.forEach((c:ICell, i:number) => {\n    const index = boardUtils.getIndexFromCell(c, board);\n    const darkTile:Phaser.TileSprite = darkTiles.children[index] as Phaser.TileSprite;\n    const point = boardUtils.getXYFromCell(c, board);\n\n    const mapElement = mapElements.children.find((el:Phaser.TileSprite) => el.x === point.x && el.y === point.y) as MapElement;\n\n    if (mapElement && mapElement.alive) {\n      mapElement.visible = true;\n    }\n\n    darkTile.game.add.tween(darkTile).to({ alpha: 0 }, 150, null, true, i * 25).onComplete.add(() => {\n      darkTile.alive = darkTile.exists = darkTile.visible = false;\n    });\n  });\n};\n\nexport const createWalls = (group:Phaser.Group, levelData:ILevelData, theme:number, board:IBoardData):void => {\n  // create top walls;\n  let i:number, frame:number;\n\n  // top walls\n  for (i = 0; i < board.cols; i++) {\n    frame = randomBetween(0, levelData.levels[theme].walls.top.length, true);\n    group.add(new Phaser.TileSprite(group.game, board.size * i + board.size, 0, board.size, board.size, 'terrain', levelData.levels[theme].walls.top[frame]));\n  }\n\n  // bottom walls\n  /*\n  for (i = 0; i < board.cols; i++) {\n    frame = randomBetween(0, levelData.levels[theme].walls.bottom.length, true);\n    group.add(new Phaser.TileSprite(group.game, board.size * i + board.size, board.rows * board.size - 1, board.size, board.size, 'terrain', levelData.levels[theme].walls.bottom[frame]));\n  }\n  */\n\n  // left walls\n  for (i = 0; i < board.rows + 1; i++) {\n    frame = randomBetween(0, levelData.levels[theme].walls.side.length, true);\n    group.add(new Phaser.TileSprite(group.game, 0, board.size * i, board.size, board.size, 'terrain', levelData.levels[theme].walls.side[frame]));\n  }\n\n  // right walls\n  for (i = 0; i < board.rows + 1; i++) {\n    frame = randomBetween(0, levelData.levels[theme].walls.side.length, true);\n    group.add(new Phaser.TileSprite(group.game, board.cols * board.size + board.size, board.size * i, board.size, board.size, 'terrain', levelData.levels[theme].walls.side[frame]));\n  }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/tslint-loader!./src/prefabs/Terrain.ts","import {IBoardData, ICell, IPoint} from '../interfaces';\n\nconst relativePositions = [\n  {row:  1, col: -1},\n  {row:  1, col:  0},\n  {row:  1, col:  1},\n  {row:  0, col: -1},\n  {row:  0, col:  1},\n  {row: -1, col: -1},\n  {row: -1, col:  0},\n  {row: -1, col:  1}\n];\n\nexport const countCells = (board:IBoardData):number =>\n  board.rows * board.cols;\n\nexport const getSurroundingCells = (cell:ICell, board:IBoardData):ICell[] => {\n  const adjacentTiles:ICell[] = [];\n\n  relativePositions.forEach((relPos:ICell):void => {\n    let relRow:number = cell.row + relPos.row;\n    let relCol:number = cell.col + relPos.col;\n\n    if (relRow >= 0 && relRow < board.rows && relCol >= 0 && relCol < board.cols) {\n      adjacentTiles.push({row: relRow, col: relCol});\n    }\n  });\n\n  return adjacentTiles;\n};\n\nexport const getXYFromCell = (cell:ICell, board:IBoardData):IPoint => ({\n  x: cell.col * board.size + board.size * .5,\n  y: cell.row * board.size + board.size * .5\n});\n\nexport const getCellFromXY = (point:IPoint, board:IBoardData):ICell => ({\n  row: point.y / board.size - .5,\n  col: point.x / board.size - .5\n});\n\nexport const getCellFromIndex = (index:number, board:IBoardData):ICell => ({\n  row: Math.floor(index / (board.rows - 1)),\n  col: index % board.cols\n});\n\nexport const getIndexFromCell = (cell:ICell, board:IBoardData):number =>\n  cell.row * board.cols + cell.col;\n\nexport const compareCells = (a:ICell, b:ICell):boolean =>\n  a.row === b.row && a.col === b.col;\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/tslint-loader!./src/utils/boardUtils.ts","import MapElement from './MapElement';\nimport {IItem} from '../interfaces';\n\nexport default class Item extends MapElement {\n  protected __data:IItem;\n\n  constructor(game:Phaser.Game, x:number, y:number, size:number, data:IItem) {\n    super(game, x, y, size, 'items', data.frames);\n    this.__data = data;\n  }\n\n  get data():IItem {\n    return this.__data;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/tslint-loader!./src/prefabs/Item.ts","import MapElement from './MapElement';\nimport {IEnemy} from '../interfaces';\n\nexport default class Enemy extends MapElement {\n  protected __data:IEnemy;\n\n  constructor(game:Phaser.Game, x:number, y:number, size:number, data:IEnemy) {\n    super(game, x, y, size, 'heroes', data.frames);\n    this.__data = data;\n  }\n\n  get data():IEnemy {\n    return this.__data;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/tslint-loader!./src/prefabs/Enemy.ts","export default class GameOverState extends Phaser.State {\n  init() {\n    // Pass user score here\n    this.game.stage.backgroundColor = 0x330000;\n  }\n  create() {\n    const gameOverText = `Congratulations!\\nYou died.\\n\\nPress any key to restart`;\n    const gameOverLabel = this.game.add.text(this.game.world.width * .5, this.game.world.height * .5, gameOverText, {\n      font: '16px Pixel',\n      fill: '#ffffff',\n      align: 'center'\n    });\n    gameOverLabel.anchor.set(.5, .5);\n\n    this.game.input.keyboard.addCallbacks(null, () => {\n      this.startGame();\n    });\n\n    this.game.input.mouse.input.onTap.addOnce(() => {\n      this.startGame();\n    });\n  }\n\n  shutdown(game:Phaser.Game) {\n    super.shutdown(game);\n    this.game.input.keyboard.removeCallbacks();\n  }\n\n  protected startGame() {\n    this.state.start('Game');\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/tslint-loader!./src/states/GameOverState.ts"],"sourceRoot":""}